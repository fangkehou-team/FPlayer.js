this.fangkehou=this.fangkehou||{},function(){function t(t,i){this.container=t,this.mMode=i.mode||fangkehou.FPlayer.MODE_LIST,this.mAutoSkip=i.autoSkip||!0,this._mPlayer=new Audio,(this._mPlayer.mFPlayerInstance=this)._mPlayer.addEventListener("canplaythrough",function(){this.mFPlayerInstance.mListener(this.mFPlayerInstance,fangkehou.FPlayer.ACTION_ON_LOAD),this.mFPlayerInstance._mIsPlaying&&this.play().catch()}),this._mPlayer.addEventListener("pause",function(){this.mFPlayerInstance._mIsPlaying&&(console.log("end of song"),this.mFPlayerInstance.mListener(this.mFPlayerInstance,fangkehou.FPlayer.ACTION_ON_NEXT),this.mFPlayerInstance.onNext())}),this._mPlayer.addEventListener("error",function(){console.log("failed to load"),this.mFPlayerInstance.mListener(this.mFPlayerInstance,fangkehou.FPlayer.ACTION_ON_FAIL),this.mFPlayerInstance._mIsPlaying&&(this.mFPlayerInstance.mAutoSkip?this.mFPlayerInstance.next():this.mFPlayerInstance.pause())}),this._mPlayer.addEventListener("timeupdate",function(){this.mFPlayerInstance._doLyricChange(this.currentTime)}),console.log("%c FPlayer %c https://github.com/fangkehou-team/FPlayer","padding: 5px; font-weight: bold; font-size: 20px; color: #272727; background: #FFD033","padding: 5px; font-weight: bold; font-size: 20px; color: #272727; background: #9EFF3C")}let i=t.prototype;(i.constructor=t).create=function(t,i={}){return t instanceof HTMLElement?new this(t,i):"string"==typeof t&&document.getElementById(t)?new this(document.getElementById(t),i):void console.error("Unable to initialize FPlayer: No valid Container available")},i.init=function(){},i.destroy=function(){},i.update=function(){},t.ACTION_PREPARE_READY="prepare_ready",t.ACTION_PREPARE_FAIL="prepare_fail",t.ACTION_ON_PLAY="on_play",t.ACTION_ON_LOAD="on_load",t.ACTION_ON_PAUSE="on_pause",t.ACTION_ON_SWITCH="on_switch",t.ACTION_ON_NEXT="on_next",t.ACTION_ON_PREVIOUS="on_previous",t.ACTION_ON_FAIL="on_fail",t.MODE_SINGLE="single",t.MODE_LIST="list",t.MODE_RANDOM="random",t.TEMPLATE_HTML_PANEL="",t.TEMPLATE_HTML_LIST="",t.TEMPLATE_HTML_LYRIC="",t.TEMPLATE_CSS="",i.mContainer=void 0,i.mTheme=void 0,i.mMusicList=[],i.mMode=void 0,i.mListener=function(t,i){},i.mAutoSkip=!0,i._mView=void 0,i._mVolume=void 0,i._mPlayList=[],i._mCurrentId=void 0,i._mPlayer=void 0,i._mIsPlaying=!1,i._mCurrentLyric=[],i._mCurrentLyricId=void 0,i._mCurrentLyricStartTime=void 0,i._mCurrentLyricEndTime=void 0,t.setTheme=function(t){this.mTheme=t},i.getTheme=function(){return this.mTheme},i.setMusicList=function(t){this.mMusicList=t,this.switch(0)},i.getMusicList=function(){return this.mMusicList},i.addMusic=function(t){this.mMusicList[this.mMusicList.length]=t,this._mPlayList[this._mPlayList.length]=t,void 0===this._mCurrentId?this.switch(0):this._refreshList()},i.setMode=function(t){this.mMode=t,this._refreshList()},i.getMode=function(){return this.mMode},i.setListener=function(t){this.mListener=t},i.play=function(){this._mIsPlaying=!0,2<=this._mPlayer.readyState&&this._mPlayer.play().catch()},i.pause=function(){this._mIsPlaying=!1,this._mPlayer.pause()},i.setProgress=function(t){2<=this._mPlayer.readyState&&this._mPlayer.duration>=t&&(this._mPlayer.currentTime=t)},i.setVolume=function(t){0<=t&&t<=1?this._mPlayer.volume=t:console.error("FPlayer: Failed to set volume")},i.onNext=function(){if(console.log("onNext"),this.mMode===fangkehou.FPlayer.MODE_SINGLE)return console.log("single mode"),this._pushSong(this._mPlayList[0]),void this.mListener(this,fangkehou.FPlayer.ACTION_ON_NEXT);this.next()},i.next=function(){var t=this._mPlayList[0];this._mPlayList.shift(),this._mPlayList.push(t),t=this._mPlayList[0],this._pushSong(t),this.play(),this.mListener(this,fangkehou.FPlayer.ACTION_ON_NEXT)},i.previous=function(){var t=this._mPlayList[this._mPlayList.length-1];this._mPlayList.unshift(t),this._mPlayList.pop(),this._pushSong(t),this.mListener(this,fangkehou.FPlayer.ACTION_ON_PREVIOUS)},i.switch=function(i){this._mPlayList=[];for(let t=i;t<this.mMusicList.length;t++)this._mPlayList[this._mPlayList.length]=this.mMusicList[t];for(let t=0;t<i;t++)this._mPlayList[this._mPlayList.length]=this.mMusicList[t];this._refreshList();var t=this._mPlayList[0];this._pushSong(t),this.mListener(this,fangkehou.FPlayer.ACTION_ON_SWITCH)},i._refreshList=function(){if(this.mMode===fangkehou.FPlayer.MODE_RANDOM){var i,e,s=this._mPlayList[0];this._mPlayList.shift();let t=this._mPlayList.length;for(;0<t;)i=Math.floor(Math.random()*t),e=this._mPlayList[t-1],this._mPlayList[t-1]=this._mPlayList[i],this._mPlayList[i]=e,t--;this._mPlayList.unshift(s)}},i._getIdByMusic=function(i){if(0==this.mMusicList.length)return-1;for(let t=0;t<this.mMusicList.length;t++)if(i.equals(this.mMusicList[t]))return t;return-1},i._pushSong=function(t){if(console.log("pushSong"),void 0!==this._mCurrentId&&t.equals(this.mMusicList[this._mCurrentId]))return console.log("single"),void(2<=this._mPlayer.readyState&&this._mPlayer.play().catch());console.log("next"),this._mCurrentId=this._getIdByMusic(t),this._mCurrentLyric=t.lrc,this._switchLyric(0),this._mPlayer.src=t.content,this._mPlayer.load()},i._doLyricChange=function(i){if(!(i>=this._mCurrentLyricStartTime&&i<this._mCurrentLyricEndTime))if(i>=this._mCurrentLyricEndTime&&this._mCurrentLyricId<this._mCurrentLyric.length-1){for(let t=this._mCurrentLyricId;t<this._mCurrentLyric.length;t++)if(i<=this._mCurrentLyric[t].time){this._switchLyric(t-1);break}}else if(i<=this._mCurrentLyricStartTime)for(let t=0;t<this._mCurrentLyricId+1;t++)if(i<=this._mCurrentLyric[t].time){this._switchLyric(t-1);break}},i._switchLyric=function(t){0!=this._mCurrentLyric[t].lyric.length?(this._mCurrentLyricId=t,this._mCurrentLyricStartTime=this._mCurrentLyric[t].time,void 0!==this._mCurrentLyric[t+1]&&(this._mCurrentLyricEndTime=this._mCurrentLyric[t+1].time),console.log(this._mCurrentLyric[t].lyric)):(this._mCurrentLyricId=t,this._mCurrentLyricEndTime=this._mCurrentLyric[t+1].time)},fangkehou.FPlayer=t}(),this.fangkehou=this.fangkehou||{},function(){function t(t,i){this.time=t,this.lyric=i}let i=t.prototype;i.constructor=t,i.time=void 0,i.lyric=void 0,t.fromLrcString=function(t){let s=t.split("\n"),n=[],r=0;for(let i=0;i<s.length;i++){let t=s[i].replace(/[\s]*\[/g,"[").replace(/][\s]*/g,"]"),e=t.substring(t.indexOf("[")+1,t.indexOf("]")).split(":");if("offset"!=e[0].toLowerCase()){if(!isNaN(parseInt(e[0]))){e=t.match(/\[[0-9:.]*]/g);let i=0;for(let t=0;t<e.length;t++)i+=e[t].length;var o=t.substring(i);for(let i=0;i<e.length;i++){let t=e[i].substring(1,e[i].length);t=t.split(":"),t=parseFloat(Math.max(60*parseInt(t[0])+parseFloat(t[1])+r/1e3,0).toFixed(3)),n[n.length]=new fangkehou.Lyric(t,o)}}}else r=parseInt(e[1])}return n.sort((t,i)=>t.time-i.time),n},fangkehou.Lyric=t}(),this.fangkehou=this.fangkehou||{},function(){function t(t,i,e,s,n){this.name=t,this.artist=i,this.cover=e,"string"==typeof s&&(this.lrc=fangkehou.Lyric.fromLrcString(s)),s instanceof Array&&(this.lrc=s),"string"==typeof n&&(this.content=n),n instanceof Blob&&(this.content=URL.createObjectURL(n))}let i=t.prototype;i.constructor=t,i.name=void 0,i.artist=void 0,i.cover=void 0,i.lrc=void 0,i.content=void 0,i.equals=function(t){let i=0;return this.name===t.name&&i++,this.artist===t.artist&&i++,this.content===t.content&&i++,this.cover===t.cover&&i++,2<=i||this.lrc===t.lrc},fangkehou.Music=t}();